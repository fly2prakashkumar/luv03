{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account within the Luv 03 application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Address": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Address",
      "type": "object",
      "description": "Represents a user's address.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this address."
        },
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "address": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "postalCode": {
          "type": "string"
        },
        "country": {
          "type": "string"
        }
      },
      "required": [
        "userId",
        "firstName",
        "lastName",
        "address",
        "city",
        "postalCode",
        "country"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a skincare product in the catalog.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "imageUrls": {
          "type": "array",
          "description": "URLs of the product images.",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "category": {
          "type": "string",
          "description": "Category of the product."
        },
        "stock": {
          "type": "number",
          "description": "Number of units in stock."
        }
      },
      "required": [
        "name",
        "description",
        "imageUrls",
        "price",
        "category",
        "stock"
      ]
    },
    "ShoppingCart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShoppingCart",
      "type": "object",
      "description": "Represents the user's shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shopping cart."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:1 ShoppingCart)"
        },
        "productIds": {
          "type": "array",
          "description": "References to Products. (Relationship: ShoppingCart 1:N Product)",
          "items": {
            "type": "string"
          }
        },
        "quantities": {
          "type": "array",
          "description": "The product quantities",
          "items": {
            "type": "number"
          }
        }
      },
      "required": [
        "id",
        "userAccountId",
        "productIds",
        "quantities"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a user's order.",
      "properties": {
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount."
        },
        "items": {
          "type": "array",
          "description": "The items included in the order.",
          "items": {
            "type": "object",
            "properties": {
              "productId": { "type": "string" },
              "name": { "type": "string" },
              "quantity": { "type": "number" },
              "price": { "type": "number" },
              "imageUrls": { "type": "array", "items": { "type": "string" } }
            },
            "required": ["productId", "name", "quantity", "price"]
          }
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "shippingAddress": {
          "type": "object",
          "properties": {
            "firstName": { "type": "string" },
            "lastName": { "type": "string" },
            "address": { "type": "string" },
            "city": { "type": "string" },
            "postalCode": { "type": "string" },
            "country": { "type": "string" }
          },
          "required": ["firstName", "lastName", "address", "city", "postalCode", "country"]
        },
        "orderDate": {
          "type": "object",
          "description": "Date the order was placed (Firestore Server Timestamp)."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., placed, shipped, delivered)."
        }
      },
      "required": [
        "userAccountId",
        "items",
        "totalAmount",
        "shippingAddress",
        "orderDate",
        "status"
      ]
    },
    "AiRecommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiRecommendation",
      "type": "object",
      "description": "Represents a product recommendation generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N AiRecommendation)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: AiRecommendation 1:1 Product)"
        },
        "recommendationReason": {
          "type": "string",
          "description": "Reason for the product recommendation generated by the AI."
        }
      },
      "required": [
        "id",
        "userAccountId",
        "productId",
        "recommendationReason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. Path-based ownership for user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/addresses/{addressId}",
        "definition": {
          "entityName": "Address",
          "schema": {
            "$ref": "#/backend/entities/Address"
          },
          "description": "Stores user's saved addresses. Path-based ownership for user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "addressId",
              "description": "The unique identifier for the address."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product catalog information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/shoppingCarts/{shoppingCartId}",
        "definition": {
          "entityName": "ShoppingCart",
          "schema": {
            "$ref": "#/backend/entities/ShoppingCart"
          },
          "description": "Stores user's shopping cart information. Path-based ownership for user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "shoppingCartId",
              "description": "The unique identifier for the shopping cart."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores user's order information. Path-based ownership for user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/aiRecommendations/{recommendationId}",
        "definition": {
          "entityName": "AiRecommendation",
          "schema": {
            "$ref": "#/backend/entities/AiRecommendation"
          },
          "description": "Stores AI product recommendations for each user. Path-based ownership for user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "recommendationId",
              "description": "The unique identifier for the AI recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to align with the application's core features and prioritize security, scalability, and debuggability, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It leverages Structural Segregation to maintain a homogeneous security posture within collections and employs Access Modeling for standardized authorization patterns.\n\n*   **User Accounts:** User data is stored under `/users/{userId}`, providing path-based ownership and simplifying security rules.\n*   **Products:** Product information is stored in the `/products` collection. List operations are secured using rules.\n*   **Shopping Carts:** Shopping carts are stored as a subcollection of users, `/users/{userId}/shoppingCarts/{shoppingCartId}`. This reflects the `User 1:1 ShoppingCart` relationship and clear ownership.\n*   **Orders:** Orders are stored as a subcollection of users, `/users/{userId}/orders/{orderId}`, reflecting the `User 1:N Order` relationship and clear ownership.\n*   **AI Recommendations:** Recommendations are stored as a subcollection of users, `/users/{userId}/aiRecommendations/{recommendationId}`, reflecting the `User 1:N AiRecommendation` relationship and clear ownership."
  }
}
    